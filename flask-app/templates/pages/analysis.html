{% extends 'base.html' %}

{% block title %}Hasil Prediksi & Visualisasi{% endblock title %}

{% block content %}
<div class="container">
    
    {% if not analysis_success %}
    <div class="result-section">
        <h3>Mulai Analisis Data</h3>
        
        <form method="GET" action="{{ url_for('pages.analyze') }}">
            <p>Data akan diproses dari <code>{{ CSV_FILENAME }}</code> untuk menghitung Regresi Linear.</p>
            <button type="submit" class="btn btn-primary">Jalankan Analisis Matriks & ML</button>
        </form>

        {% if error_message %}
            <div class="alert alert-danger">
                <strong>Terjadi Kesalahan!</strong> {{ error_message }}
            </div>
        {% endif %}
    </div>
    {% endif %}
    
    {% if analysis_success %}
    
    <div class="result-section" style="display: flex; justify-content: space-around; background-color: #f0f0f0;">
        <div style="text-align: center;">
            <h4>INTERCEPT (b₀)</h4>
            <p style="font-size: 1.5em; font-weight: bold; color: #007bff;">{{ weights.intercept|round(4) }}</p>
        </div>
        <div style="text-align: center;">
            <h4>SLOPE (b₁)</h4>
            <p style="font-size: 1.5em; font-weight: bold; color: #28a745;">{{ weights.slope|round(4) }}</p>
        </div>
        
        <div style="text-align: center;">
            <h4>R-SQUARED (R²)</h4>
            <p style="font-size: 1.5em; font-weight: bold; color: #ffc107;">{{ r_squared|round(4) }}</p>
        </div>
        
        <div style="text-align: center;">
            <h4>RMSE</h4>
            <p style="font-size: 1.5em; font-weight: bold; color: #dc3545;">{{ rmse|round(4) }}</p>
        </div>
    </div>
    
    <div style="display: flex; gap: 20px; margin-top: 20px;">
        
        <div class="result-section" style="flex: 3; background-color: white;">
            <h3>Visualisasi Prediksi</h3>
            <div id="chart-container" style="height: 450px;">
                <canvas id="regressionChart"></canvas> 
            </div>
        </div>

        <div class="result-section" style="flex: 2; background-color: white;">
            <h3>Interpretasi Hasil</h3>
            <p>{{ interpretation }}</p>
            <hr>
            <p><strong>Sumber Data:</strong> <code>{{ CSV_FILENAME }}</code></p>
            <p><strong>Fitur (X):</strong> {{ feature_name }}</p>
            <p><strong>Target (Y):</strong> {{ target_name }}</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="{{ url_for('static', filename='js/chart_logic.js') }}"></script>
    <script>
        const rawChartData = {{ chart_data | tojson }};

        document.addEventListener('DOMContentLoaded', function() {
            if (rawChartData && rawChartData.X_data.length > 0) {
                // drawRegressionChart() adalah fungsi dari chart_logic.js
                drawRegressionChart(rawChartData);
            }
        });
    </script>
    
    {% endif %}
</div>
{% endblock content %}